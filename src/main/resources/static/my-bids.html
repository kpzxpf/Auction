<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Мои ставки | Аукцион.ру</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
    <div class="container">
        <a class="navbar-brand" href="index.html"><i class="fas fa-gavel"></i> Аукцион.ру</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" href="my-bids.html">Мои ставки</a></li>
                <li class="nav-item"><a class="nav-link" id="profileLink" href="profile.html" style="display: none;"><i class="fas fa-user"></i> Профиль</a></li>
                <li class="nav-item"><a class="nav-link" id="loginLink" href="login.html">Вход</a></li>
                <li class="nav-item"><a class="nav-link" id="registerLink" href="register.html">Регистрация</a></li>
                <li class="nav-item"><button id="logoutButton" class="btn btn-danger btn-sm" style="display: none;">Выйти</button></li>
            </ul>
        </div>
    </div>
</nav>

<div class="container mt-5">
    <h2>Мои ставки</h2>
    <div id="bids-list" class="row mt-3"></div>
</div>

<footer class="bg-dark text-light text-center py-3 mt-5">
    <p>© 2025 Аукцион.ру. Все права защищены.</p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const userId = localStorage.getItem('userId');
        if (!userId) {
            window.location.href = 'login.html';
            return;
        }

        loadUserBids(userId);
        updateNavigation();
    });

    async function loadUserBids(userId) {
        try {
            const response = await fetch('http://localhost:8080/bids/user', {
                headers: { 'X-User-Id': userId }
            });
            if (!response.ok) throw new Error('Ошибка загрузки ставок');
            const bids = await response.json();
            displayUserBids(bids);
        } catch (error) {
            console.error('Ошибка:', error);
            alert('Ошибка при загрузке ставок');
        }
    }

    function displayUserBids(bids) {
        const container = document.getElementById('bids-list');
        container.innerHTML = '';
        if (bids.length === 0) {
            container.innerHTML = '<p class="text-center">Вы еще не сделали ставок.</p>';
            return;
        }

        bids.forEach(bid => {
            const bidElement = document.createElement('div');
            bidElement.className = 'col-md-4 mb-4';
            bidElement.innerHTML = `
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Лот: ${bid.lotTitle}</h5>
                        <p class="card-text"><strong>Ставка:</strong> ${bid.amount}₽</p>
                        <p class="card-text"><strong>Дата:</strong> ${new Date(bid.createdAt).toLocaleString()}</p>
                    </div>
                </div>
            `;
            container.appendChild(bidElement);
        });
    }

    function updateNavigation() {
        const userId = localStorage.getItem('userId');
        const profileLink = document.getElementById('profileLink');
        const logoutButton = document.getElementById('logoutButton');
        const loginLink = document.getElementById('loginLink');
        const registerLink = document.getElementById('registerLink');

        if (userId) {
            profileLink.style.display = 'block';
            logoutButton.style.display = 'block';
            loginLink.style.display = 'none';
            registerLink.style.display = 'none';
            logoutButton.onclick = () => {
                localStorage.removeItem('userId');
                window.location.href = 'login.html';
            };
        } else {
            profileLink.style.display = 'none';
            logoutButton.style.display = 'none';
            loginLink.style.display = 'block';
            registerLink.style.display = 'block';
        }
    }
</script>
</body>
</html>